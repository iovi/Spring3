Веб-приложение Spring3 обеспечивает простой механизм выявления ботов - позволяет клиенту зарегистрироваться, получить новую captcha-картинку, разгадать ее и проверить результат.

Сборка и запуск

Приложение можно запустить с помощью команды "java -jar Spring3-0.2.0.jar" (файл Spring3-0.1.0.jar находится в директории Spring3\target, необходимо перейти в нее для запуска данной командой). Требуется установленная Java 8 на сервере приложения.
При необходимости можно пересобрать исполняемый файл Spring3-0.2.0.jar с помощью Apache Maven (запустить "mvn clean install" в директории Spring3/ - при этом также будут выполнены тесты приложения).



Описание решения

1. Регистрация
Приложение регистрирует нового клиента при POST-запросе на http://hostname:8080/client/register, где hostname - имя или IP-адрес сервера, на котором приложение запущено.
В ответе возвращается JSON-объект  с  двумя UUID-строками: secret–приватный ключ клиента, public–публичный ключ, используемый на сайте.
Внимание! У клиента существует срок действия 5 минут. По истечению этого периода необходима новая регистрация, запросы по устаревшему клиенту будут возвращать код ответа 403.

2. Создание новой CAPTCHA
Приложение создает новую CAPTCHA для клиента при GET-запросе на http://hostname:8080/captcha/new с параметром public - публичный ключ зарегистрированного клиента. При некорректном указании public в этом и последующих запросах возвращается код ответа 403.
В  теле  ответа  приходит JSON-объект с двумя строками: request – идентификатор CAPTCHA, answer – слово-разгадка к решению теста. Разгадка передается только, если приложение работает не в продуктивном режиме (системный параметр production="false"), в остальных случаях answer=null.

3. Вывод CAPTCHA-картинки
Приложение показывает картинку CAPTCHA при GET-запросе на http://hostname:8080/captcha/image с параметрами 
* public - публичный ключ зарегистрированного клиента
* request - идентификатор CAPTCHA). Необходимо, чтобы идентификатор ранее выдавался в ответ на captcha/new именно этому клиенту, в противном случае вернется код ответа 403.
На картинке будет зашифрован 6-символьный текст, в котором символами могут быть латинские буквы верхнего и нижнего регистра (последующая проверка - регистрозависимая) и цифры. Картинка выводится только один раз.
На выведенной странице содержится поле ввода, в которое пользователь может ввести предполагаемый текст и проверить его по нажатию "Check" (будет отправлен POST-запрос описаный в п.4)

4. Решение CAPTHCHA
Приложение проверяет решение CAPTCHA при POST-запросе на http://hostname:8080/captcha/solve с параметрами 
* public - публичный ключ зарегистрированного клиента
* request - идентификатор CAPTCHA. Необходимо, чтобы идентификатор ранее выдавался именно этому клиенту в ответ на captcha/new, в противном случае вернется код ответа 403.
* answer - предполагаемая разгадка
В теле ответа возвращается JSON-объект с одной строкой response - токен для потверждения клиента. При неуспешной разгадке токен будет равен null, будет возвращен код ответа 422.
Разгадка считается верной при выполнении следующих условий:
- Текст из параметра должен совпадать с зашфрованным для указанного id captcha 
- Для одной captcha можно пройти проверку только 1 раз (независимо от того, была первая проверка успешной или нет, последующие запросы вернут код ответа 403)
- Выполнить успешную проверку можно только до истечения срока действия captcha с момента ее создания (запрос 2). Срок действия определяется системным параметром ttl в секундах. Если он не задан, используется срок действия по умолчанию - 1 минута.

5. Подтверждение клиента
Приложение проверяет подтверждающий токен клиента при GET-запросе на http://hostname:8080/captcha/verify с параметрами 
* secret - секретный ключ зарегистрированного клиента
* response - подтверждающий токен, ранее выдававшийся указанному клиенту (в запросе 4). Проверить токен можно только 1 раз
В ответе возвращается JSON-объект с двумя полями: success – результат проверки (булевый  тип), errorCode – строка с кодом ошибки. Возможные коды ошибок:
- null - ошибки нет, такой токен выдавался такому клиенту
- NoTokenForSuchKey - для такого секретного ключа токена не существует. Возможен при некорреткном указании секретного ключа или при повторной проверке (выданный токен - одноразовый, проверить его можно только 1 раз независимо от результата проверки)
- IncorrectToken - токен указан некорреткно
- ClientIsExpired - срок действия клиента истек
При неуспешной проверке возвращается код ответа 422, при успешной - 200.
